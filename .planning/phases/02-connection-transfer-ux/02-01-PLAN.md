---
phase: 02-connection-transfer-ux
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [app/composables/useToast.ts, app/components/Toast.vue, app/composables/useWebRTC.ts]
autonomous: true
---

<objective>
Create toast notification system and add proper connection state tracking.

Purpose: Foundation for UI-03 (connection states) and UI-05 (graceful error handling). These building blocks enable the UI improvements in Plan 02.
Output: useToast composable, Toast component, and connectionState tracking in useWebRTC.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/CONVENTIONS.md
@.planning/codebase/ARCHITECTURE.md

@app/composables/useWebRTC.ts
@app/app.vue
@app/assets/css/main.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create toast notification composable and component</name>
  <files>app/composables/useToast.ts, app/components/Toast.vue</files>
  <action>
    Create `useToast.ts` composable following existing composable patterns:
    - Export a singleton pattern (shared state across components)
    - `toasts` ref array with: id, type (success/error/info/warning), message, duration
    - `showToast(type, message, duration?)` function
    - `success(message)`, `error(message)`, `info(message)` helpers
    - `removeToast(id)` function
    - Auto-remove after duration (default 4000ms)

    Create `Toast.vue` component:
    - Position: fixed bottom-right, stacked vertically
    - Use CSS theme variables (--color-success, --color-error, etc.)
    - Slide-in animation from right
    - Close button on each toast
    - Icons per type: success (checkmark), error (X), info (i), warning (!)
    - Support dark mode via existing theme system
  </action>
  <verify>
    - Files exist and TypeScript compiles: `npm run build`
    - Toast types are properly defined
  </verify>
  <done>useToast composable exports showToast/success/error/info, Toast.vue renders positioned notifications</done>
</task>

<task type="auto">
  <name>Task 2: Add connection state tracking to useWebRTC</name>
  <files>app/composables/useWebRTC.ts</files>
  <action>
    Enhance useWebRTC composable to track connection states:

    1. Add `connectionStates` ref: `Map<peerId, 'connecting' | 'connected' | 'disconnected' | 'error'>`

    2. Update `connectToPeer()`:
       - Set state to 'connecting' before attempting connection
       - Set state to 'connected' on successful open event
       - Set state to 'error' on connection error
       - Set state to 'disconnected' on close event

    3. Add connection event listeners:
       - `conn.on('open', ...)` - mark connected
       - `conn.on('close', ...)` - mark disconnected
       - `conn.on('error', ...)` - mark error

    4. Export `connectionStates` and add helper:
       - `getConnectionState(peerId): string` function

    5. Handle incoming connections (peer.on('connection')) with same state tracking

    Keep existing functionality intact - this is additive.
  </action>
  <verify>
    - `npm run build` passes
    - connectionStates is exported from useWebRTC
    - No changes to existing connection logic behavior
  </verify>
  <done>useWebRTC exports connectionStates map and getConnectionState helper, states update on connection lifecycle events</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] useToast.ts exports: toasts, showToast, success, error, info, removeToast
- [ ] Toast.vue renders with proper styling and animations
- [ ] useWebRTC.ts exports: connectionStates, getConnectionState
- [ ] No TypeScript errors
</verification>

<success_criteria>
- Toast notification system ready for use (not yet integrated)
- Connection states tracked throughout lifecycle
- Existing functionality unchanged
- Build passes
</success_criteria>

<output>
After completion, create `.planning/phases/02-connection-transfer-ux/02-01-SUMMARY.md`
</output>
