---
phase: 02-connection-transfer-ux
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified: [app/pages/index.vue, app/components/DeviceList.vue, app/app.vue]
autonomous: false
---

<objective>
Integrate toast notifications, display connection states in UI, and replace all alert() calls.

Purpose: Complete UI-03 (connection states), UI-04 (transfer progress enhancement), and UI-05 (graceful error handling).
Output: Polished connection feedback UX with toast notifications.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-connection-transfer-ux/02-01-SUMMARY.md

@app/pages/index.vue
@app/components/DeviceList.vue
@app/components/TransferProgress.vue
@app/composables/useToast.ts
@app/composables/useWebRTC.ts
@app/app.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Mount Toast component globally and replace alert() calls</name>
  <files>app/app.vue, app/pages/index.vue</files>
  <action>
    1. In app.vue:
       - Import and mount Toast component at root level (after NuxtLayout)
       - This makes toasts visible on all pages

    2. In index.vue, replace all alert() calls with toast notifications:
       - Line ~164: `alert('Cannot connect...')` → `error('Cannot connect: Device has no peer ID')`
       - Line ~184: `alert(\`Connected to ${device.name}!\`)` → `success(\`Connected to ${device.name}\`)`
       - Line ~188: `alert(\`Failed to connect...\`)` → `error(\`Failed to connect to ${device.name}: ${errorMsg}\`)`

    3. Import useToast at top of index.vue script:
       `const { success, error } = useToast()`

    4. Remove all remaining alert() calls - search for any others and replace appropriately
  </action>
  <verify>
    - `npm run build` passes
    - `grep -r "alert(" app/` returns no results in Vue/TS files
    - Toast component imported in app.vue
  </verify>
  <done>No alert() calls remain, all user feedback uses toast notifications</done>
</task>

<task type="auto">
  <name>Task 2: Show connection states in UI</name>
  <files>app/pages/index.vue, app/components/DeviceList.vue</files>
  <action>
    1. In index.vue:
       - Import connectionStates from useWebRTC
       - Update the connection status indicator to show "Connecting..." state with spinner/animation
       - Add visual states: connecting (orange/amber pulse), connected (green), disconnected (gray), error (red)

    2. Update local device status indicator:
       - Show WebSocket connection state (already has isConnected)
       - Add subtle pulse animation when connected

    3. In DeviceList.vue:
       - Accept connectionStates as prop
       - Show connection state per device card (connecting spinner, connected checkmark, etc.)
       - Update device card styling to reflect state:
         - Connecting: orange border, spinner icon
         - Connected: green border, checkmark badge (existing)
         - Available: default styling

    4. Update the connected devices section in index.vue:
       - Show "Connecting..." text and spinner when state is 'connecting'
       - Animate transition between states
  </action>
  <verify>
    - `npm run build` passes
    - No TypeScript errors
    - Connection states visually distinct
  </verify>
  <done>UI shows connecting/connected/disconnected states with appropriate visual feedback</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete connection & transfer UX improvements: toast notifications replacing alerts, connection state indicators (connecting spinner, connected checkmark), and visual feedback throughout connection lifecycle</what-built>
  <how-to-verify>
    **Test toast notifications:**
    1. Run: `npm run dev`
    2. Open http://localhost:3000 in two browser tabs (Tab A: Chrome, Tab B: Chrome Incognito or different browser)
    3. Wait for devices to discover each other

    **Test connection states:**
    4. In Tab A, click on Tab B's device to select it
    5. Click "Connect" - you should see:
       - "Connecting..." state with spinner/animation
       - Toast notification "Connected to [device]" on success
       - Device card shows green connected state
    6. Try connecting when Tab B is closed - should see error toast instead of alert()

    **Test error handling:**
    7. Close Tab B while connected
    8. Try to send a file from Tab A - should show error toast, not alert()

    **Verify visual polish:**
    9. Check that states have clear visual distinction
    10. Check dark mode still works
    11. Check toasts appear in bottom-right, stack properly, auto-dismiss
  </how-to-verify>
  <resume-signal>Type "approved" if UX works well, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] No alert() calls in codebase
- [ ] Toast notifications appear for success/error events
- [ ] Connection states visually indicated (connecting/connected/disconnected)
- [ ] Dark mode compatibility maintained
- [ ] `npm run build` passes
</verification>

<success_criteria>
- UI-03: Connection states clearly shown (connecting, connected, disconnected)
- UI-04: Transfer progress visible (already exists, verify still works)
- UI-05: All errors shown via toast notifications, no alert() calls
- User approved visual verification
</success_criteria>

<output>
After completion, create `.planning/phases/02-connection-transfer-ux/02-02-SUMMARY.md`
</output>
